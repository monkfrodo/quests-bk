<!doctype html>
<html lang="pt-br">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Quest Teams | Blackout Guild</title>

<link rel="icon" href="https://www.tibiawiki.com.br/images/6/63/Icone7.png" type="image/png">
<link rel="shortcut icon" href="https://www.tibiawiki.com.br/images/6/63/Icone7.png" type="image/png">
<link rel="apple-touch-icon" href="https://www.tibiawiki.com.br/images/6/63/Icone7.png">

<style>
  :root{
    --bg:#0b1220;
    --card:#0a0f19d9;
    --border:rgba(255,255,255,.08);
    --accent:#3b82f6;
    --muted:#8fa1c2;
    --green:#22c55e;
    --orange:#f59e0b;
    --red:#ef4444;
  }
  *{box-sizing:border-box}
  body{
    margin:0; min-height:100vh; color:#e5ecff;
    font-family:Inter,system-ui,sans-serif;
    background:url('https://preview.redd.it/i-tried-to-make-a-version-of-tibia-8-6-screen-with-more-v0-gcs5d4co5z891.png?width=1080&crop=smart&auto=webp&s=9858d97fff58d708fca33a391d49cd726347ee21') no-repeat center top / cover fixed;
    position:relative;
  }
  body::before{
    content:""; position:fixed; inset:0; z-index:0;
    background:linear-gradient(rgba(0,0,0,.7), rgba(0,0,0,.9));
    pointer-events:none;
  }
  .wrap{position:relative; z-index:1; max-width:1100px; margin:0 auto; padding:60px 16px 40px}
  header{display:flex; align-items:center; justify-content:center; gap:12px; margin-bottom:16px}
  header img{width:40px; height:auto; opacity:.9}
  h1{margin:0; font-size:28px; font-weight:800; text-align:center}
  .subtitle{text-align:center;color:var(--muted);font-size:15px;margin-bottom:26px}
  .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:24px;box-shadow:0 4px 25px rgba(0,0,0,.3);margin-bottom:28px}
  .form-grid{display:grid;gap:14px;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));align-items:end}
  label{font-size:13px;color:var(--muted);display:block;margin-bottom:6px}
  input,select{width:100%;padding:12px 14px;border-radius:10px;border:1px solid var(--border);background:#10182b;color:#e5ecff;font-size:15px}
  .btn{padding:14px 22px;border:none;border-radius:12px;font-weight:700;background:var(--accent);color:#fff;cursor:pointer;transition:.2s}
  .btn:hover{opacity:.9;transform:translateY(-1px)}

  .autocomplete{position:relative}
  .autocomplete-list{position:absolute;top:100%;left:0;right:0;z-index:20;background:#10182b;border:1px solid rgba(255,255,255,.15);border-radius:10px;margin-top:6px;max-height:220px;overflow:auto;display:none}
  .autocomplete-item{padding:10px 12px;cursor:pointer;font-size:14px}
  .autocomplete-item:hover{background:rgba(255,255,255,.1)}

  .quests{display:grid;gap:16px;grid-template-columns:repeat(auto-fit,minmax(260px,1fr))}
  .quest{background:rgba(255,255,255,.05);border:1px solid var(--border);border-radius:16px;padding:16px;transition:.25s;cursor:pointer;position:relative;overflow:hidden}
  .quest:hover{background:rgba(255,255,255,.08);transform:translateY(-2px)}
  .q-head{display:flex;align-items:center;justify-content:space-between;gap:8px}
  .q-title{font-weight:800;display:flex;align-items:center;gap:8px}
  .q-title img{width:22px;height:22px;object-fit:contain;vertical-align:middle}
  .bar{margin-top:10px;height:8px;background:#0b1220;border-radius:999px;overflow:hidden}
  .fill{height:100%;width:0%;transition:width .5s,background .5s}
  .players{display:none;margin-top:10px;border-top:1px solid var(--border);padding-top:10px}
  .player{font-size:14px;color:#cfe2ff;margin:4px 0}
  .muted{color:var(--muted);font-size:13px}
  .footer{margin-top:34px;text-align:center;color:var(--muted);font-size:13px;border-top:1px solid rgba(255,255,255,.1);padding-top:18px}
  .footer .icon{display:flex;justify-content:center;margin-top:18px}
  .footer .icon img{width:120px;opacity:.8}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <img src="https://www.tibiawiki.com.br/images/6/63/Icone7.png" alt="Icone">
    <h1>Quest Teams | Blackout Guild</h1>
  </header>
  <div class="subtitle">Monte times para quests. Digite a quest e veja quem já está dentro.</div>

  <div class="card">
    <form id="form">
      <div class="form-grid">
        <div><label>Nome</label><input id="nome" placeholder="Seu nome" required></div>
        <div><label>Vocação</label>
          <select id="vocacao" required>
            <option value="">Selecione</option>
            <option>EK</option><option>RP</option><option>MS</option><option>ED</option><option>EM</option>
          </select>
        </div>
        <div><label>Level</label><input id="level" type="number" min="1" step="1" placeholder="Ex: 250" required></div>
        <div class="autocomplete"><label>Quest</label>
          <input id="quest" placeholder="Digite a quest..." autocomplete="off" required>
          <div id="acList" class="autocomplete-list"></div>
        </div>
      </div>
      <div style="margin-top:14px;display:flex;justify-content:center">
        <button class="btn" type="submit">Registrar interesse</button>
      </div>
    </form>
    <div id="status" class="muted" style="text-align:center;margin-top:8px"></div>
  </div>

  <div id="quests" class="quests"></div>

  <div class="footer">
    <strong>Blackout Guild | Todos os direitos reservados.</strong>
    <div class="icon"><img src="https://www.tibiawiki.com.br/images/6/63/Icone7.png"></div>
  </div>
</div>

<script>
  const API = "https://script.google.com/macros/s/AKfycbziIHrXBpoNWvDiclUBfNu-YrxfGVJMZ70LOrxWzKlDHAOQxhbYsEtwpT-YoSEBRbss1w/exec";

  const icons = [
    "https://www.tibiawiki.com.br/images/9/96/Icone15.png",
    "https://www.tibiawiki.com.br/images/d/d7/Icone16.png",
    "https://www.tibiawiki.com.br/images/6/67/Icone10.png",
    "https://www.tibiawiki.com.br/images/9/9b/Snowbash.gif",
    "https://www.tibiawiki.com.br/images/a/a8/Icone2.png",
    "https://www.tibiawiki.com.br/images/3/37/Icone3.png",
    "https://www.tibiawiki.com.br/images/6/65/Icone14.png",
    "https://www.tibiawiki.com.br/images/3/36/Icone13.png"
  ];

  let allQuestNames = [], lastData = [];
  const $ = s => document.querySelector(s), acList = $('#acList'), statusEl = $('#status');

  function fillColor(count){
    if (count <= 2) return "var(--red)";
    if (count <= 4) return "var(--orange)";
    return "var(--green)";
  }
  function barWidth(count){return Math.min((count/5)*100,100)+'%'}

  function showAutocomplete(term){
    acList.innerHTML=''; term=(term||'').trim().toLowerCase();
    if(!term){acList.style.display='none';return;}
    const filtered=allQuestNames.filter(q=>q.toLowerCase().includes(term)).slice(0,12);
    if(!filtered.length){acList.style.display='none';return;}
    filtered.forEach(q=>{
      const div=document.createElement('div');
      div.className='autocomplete-item'; div.textContent=q;
      div.onclick=()=>{$('#quest').value=q;acList.style.display='none';};
      acList.appendChild(div);
    });
    acList.style.display='block';
  }
  $('#quest').addEventListener('input',e=>showAutocomplete(e.target.value));
  document.addEventListener('click',e=>{if(!e.target.closest('.autocomplete'))acList.style.display='none'});

  function render(data){
    const serialized=JSON.stringify(data);
    if(serialized===JSON.stringify(lastData))return;
    lastData=data; allQuestNames=data.map(q=>q.quest).filter(Boolean);
    const wrap=$('#quests'); wrap.innerHTML='';
    if(!data.length){wrap.innerHTML='<div class="muted" style="grid-column:1/-1;text-align:center">Nenhuma quest registrada ainda.</div>';return;}
    data.forEach(q=>{
      const card=document.createElement('div'); card.className='quest';
      const icon = icons[Math.floor(Math.random()*icons.length)];
      card.innerHTML=`
        <div class="q-head">
          <div class="q-title"><img src="${icon}" alt="">${q.quest}</div>
          <div class="muted">${q.count} jogador${q.count>1?'es':''}</div>
        </div>
        <div class="bar"><div class="fill" style="width:${barWidth(q.count)};background:${fillColor(q.count)}"></div></div>
        <div class="players">
          ${Array.isArray(q.players)&&q.players.length?q.players.map(p=>`<div class="player">• <b>${p.nome||'Sem nome'}</b> (${p.vocacao||'—'}, lvl ${p.level||'—'})</div>`).join(''):'<div class="muted">Ainda sem jogadores listados.</div>'}
        </div>`;
      card.addEventListener('click',()=>{const pl=card.querySelector('.players');pl.style.display=pl.style.display==='block'?'none':'block';});
      wrap.appendChild(card);
    });
  }

  async function fetchQuests(){
    try{
      statusEl.textContent='Carregando times...';
      const res=await fetch(API); const data=await res.json();
      render(Array.isArray(data)?data:[]); statusEl.textContent='';
    }catch(e){statusEl.textContent='Erro ao carregar.';console.error(e);}
  }

  $('#form').addEventListener('submit',async e=>{
    e.preventDefault();
    const nome=$('#nome').value.trim(), voc=$('#vocacao').value.trim(), lvl=$('#level').value.trim(), quest=$('#quest').value.trim();
    if(!nome||!voc||!lvl||!quest)return;
    try{
      statusEl.textContent='Enviando...';
      const fd=new FormData(); fd.append('nome',nome); fd.append('vocacao',voc); fd.append('level',lvl); fd.append('quest',quest);
      await fetch(API,{method:'POST',body:fd,mode:'no-cors'});
      $('#form').reset(); acList.style.display='none'; statusEl.textContent='Registrado!';
      setTimeout(fetchQuests,1200);
    }catch(err){statusEl.textContent='Falha ao registrar.';console.error(err);}
  });

  fetchQuests(); setInterval(fetchQuests,30000);
</script>
</body>
</html>
